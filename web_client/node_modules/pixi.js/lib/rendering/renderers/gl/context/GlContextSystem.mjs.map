{"version":3,"file":"GlContextSystem.mjs","sources":["../../../../../src/rendering/renderers/gl/context/GlContextSystem.ts"],"sourcesContent":["import { DOMAdapter } from '../../../../environment/adapter';\nimport { ExtensionType } from '../../../../extensions/Extensions';\nimport { warn } from '../../../../utils/logging/warn';\nimport { type GpuPowerPreference } from '../../types';\n\nimport type { ICanvas } from '../../../../environment/canvas/ICanvas';\nimport type { System } from '../../shared/system/System';\nimport type { WebGLRenderer } from '../WebGLRenderer';\nimport type { WebGLExtensions } from './WebGLExtensions';\n\n/**\n * Options for the context system.\n * @category rendering\n * @advanced\n * @property {WebGL2RenderingContext | null} [context=null] - User-provided WebGL rendering context object.\n * @property {GpuPowerPreference} [powerPreference='default'] - An optional hint indicating what configuration\n * of GPU is suitable for the WebGL context, can be `'high-performance'` or `'low-power'`. Setting to `'high-performance'`\n * will prioritize rendering performance over power consumption, while setting to `'low-power'` will prioritize power saving\n * over rendering performance.\n * @property {boolean} [premultipliedAlpha=true] - Whether the compositor will assume the drawing buffer contains\n * colors with premultiplied alpha.\n * @property {boolean} [preserveDrawingBuffer=false] - Whether to enable drawing buffer preservation.\n * If enabled, the drawing buffer will preserve\n * its value until cleared or overwritten. Enable this if you need to call `toDataUrl` on the WebGL context.\n * @property {boolean} [antialias] - Whether to enable antialiasing.\n * @property {1 | 2} [preferWebGLVersion=2] - The preferred WebGL version to use.\n */\nexport interface ContextSystemOptions\n{\n    /**\n     * User-provided WebGL rendering context object.\n     * @default null\n     */\n    context: WebGL2RenderingContext | null;\n    /**\n     * An optional hint indicating what configuration of GPU is suitable for the WebGL context,\n     * can be `'high-performance'` or `'low-power'`.\n     * Setting to `'high-performance'` will prioritize rendering performance over power consumption,\n     * while setting to `'low-power'` will prioritize power saving over rendering performance.\n     * @default undefined\n     */\n    powerPreference?: GpuPowerPreference;\n\n    /**\n     * Whether the compositor will assume the drawing buffer contains colors with premultiplied alpha.\n     * @default true\n     */\n    premultipliedAlpha: boolean;\n    /**\n     * Whether to enable drawing buffer preservation. If enabled, the drawing buffer will preserve\n     * its value until cleared or overwritten. Enable this if you need to call `toDataUrl` on the WebGL context.\n     * @default false\n     */\n    preserveDrawingBuffer: boolean;\n\n    antialias?: boolean;\n\n    /**\n     * The preferred WebGL version to use.\n     * @default 2\n     */\n    preferWebGLVersion?: 1 | 2;\n\n    /**\n     * Whether to enable multi-view rendering. Set to true when rendering to multiple\n     * canvases on the dom.\n     * @default false\n     */\n    multiView: boolean;\n}\n\n/**\n * System plugin to the renderer to manage the context\n * @category rendering\n * @advanced\n */\nexport class GlContextSystem implements System<ContextSystemOptions>\n{\n    /** @ignore */\n    public static extension = {\n        type: [\n            ExtensionType.WebGLSystem,\n        ],\n        name: 'context',\n    } as const;\n\n    /** The default options for the system. */\n    public static defaultOptions: ContextSystemOptions = {\n        /**\n         * {@link WebGLOptions.context}\n         * @default null\n         */\n        context: null,\n        /**\n         * {@link WebGLOptions.premultipliedAlpha}\n         * @default true\n         */\n        premultipliedAlpha: true,\n        /**\n         * {@link WebGLOptions.preserveDrawingBuffer}\n         * @default false\n         */\n        preserveDrawingBuffer: false,\n        /**\n         * {@link WebGLOptions.powerPreference}\n         * @default default\n         */\n        powerPreference: undefined,\n        /**\n         * {@link WebGLOptions.webGLVersion}\n         * @default 2\n         */\n        preferWebGLVersion: 2,\n        /**\n         * {@link WebGLOptions.multiView}\n         * @default false\n         */\n        multiView: false\n    };\n\n    protected CONTEXT_UID: number;\n    protected gl: WebGL2RenderingContext;\n\n    /**\n     * Features supported by current renderer.\n     * @type {object}\n     * @readonly\n     */\n    public supports = {\n        /** Support for 32-bit indices buffer. */\n        uint32Indices: true,\n        /** Support for UniformBufferObjects */\n        uniformBufferObject: true,\n        /** Support for VertexArrayObjects */\n        vertexArrayObject: true,\n        /** Support for SRGB texture format */\n        srgbTextures: true,\n        /** Support for wrapping modes if a texture is non-power of two */\n        nonPowOf2wrapping: true,\n        /** Support for MSAA (antialiasing of dynamic textures) */\n        msaa: true,\n        /** Support for mipmaps if a texture is non-power of two */\n        nonPowOf2mipmaps: true,\n    };\n\n    /**\n     * Extensions available.\n     * @type {object}\n     * @readonly\n     * @property {WEBGL_draw_buffers} drawBuffers - WebGL v1 extension\n     * @property {WEBGL_depth_texture} depthTexture - WebGL v1 extension\n     * @property {OES_texture_float} floatTexture - WebGL v1 extension\n     * @property {WEBGL_lose_context} loseContext - WebGL v1 extension\n     * @property {OES_vertex_array_object} vertexArrayObject - WebGL v1 extension\n     * @property {EXT_texture_filter_anisotropic} anisotropicFiltering - WebGL v1 and v2 extension\n     */\n    public extensions: WebGLExtensions;\n\n    public webGLVersion: 1 | 2;\n\n    /**\n     * Whether to enable multi-view rendering. Set to true when rendering to multiple\n     * canvases on the dom.\n     * @default false\n     */\n    public multiView: boolean;\n\n    /**\n     * The canvas that the WebGL Context is rendering to.\n     * This will be the view canvas. But if multiView is enabled, this canvas will not be attached to the DOM.\n     * It will be rendered to and then copied to the target canvas.\n     * @readonly\n     */\n    public canvas: ICanvas;\n\n    private _renderer: WebGLRenderer;\n    private _contextLossForced: boolean;\n\n    /** @param renderer - The renderer this System works for. */\n    constructor(renderer: WebGLRenderer)\n    {\n        this._renderer = renderer;\n\n        this.extensions = Object.create(null);\n\n        // Bind functions\n        this.handleContextLost = this.handleContextLost.bind(this);\n        this.handleContextRestored = this.handleContextRestored.bind(this);\n    }\n\n    /**\n     * `true` if the context is lost\n     * @readonly\n     */\n    get isLost(): boolean\n    {\n        return (!this.gl || this.gl.isContextLost());\n    }\n\n    /**\n     * Handles the context change event.\n     * @param {WebGLRenderingContext} gl - New WebGL context.\n     */\n    protected contextChange(gl: WebGL2RenderingContext): void\n    {\n        this.gl = gl;\n        this._renderer.gl = gl;\n    }\n\n    public init(options: ContextSystemOptions): void\n    {\n        options = { ...GlContextSystem.defaultOptions, ...options };\n\n        // TODO add to options\n        let multiView = this.multiView = options.multiView;\n\n        if (options.context && multiView)\n        {\n            // eslint-disable-next-line max-len\n            warn('Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together.');\n\n            multiView = false;\n        }\n\n        if (multiView)\n        {\n            this.canvas = DOMAdapter.get()\n                .createCanvas(this._renderer.canvas.width, this._renderer.canvas.height);\n        }\n        else\n        {\n            this.canvas = this._renderer.view.canvas;\n        }\n        /*\n         * The options passed in to create a new WebGL context.\n         */\n        if (options.context)\n        {\n            this.initFromContext(options.context);\n        }\n        else\n        {\n            const alpha = this._renderer.background.alpha < 1;\n            const premultipliedAlpha = options.premultipliedAlpha ?? true;\n            const antialias = options.antialias && !this._renderer.backBuffer.useBackBuffer;\n\n            this.createContext(options.preferWebGLVersion, {\n                alpha,\n                premultipliedAlpha,\n                antialias,\n                stencil: true,\n                preserveDrawingBuffer: options.preserveDrawingBuffer,\n                powerPreference: options.powerPreference ?? 'default',\n            });\n        }\n    }\n\n    public ensureCanvasSize(targetCanvas: ICanvas): void\n    {\n        if (!this.multiView)\n        {\n            if (targetCanvas !== this.canvas)\n            {\n                warn('multiView is disabled, but targetCanvas is not the main canvas');\n            }\n\n            return;\n        }\n\n        const { canvas } = this;\n\n        if (canvas.width < targetCanvas.width || canvas.height < targetCanvas.height)\n        {\n            canvas.width = Math.max(targetCanvas.width, targetCanvas.width);\n            canvas.height = Math.max(targetCanvas.height, targetCanvas.height);\n        }\n    }\n\n    /**\n     * Initializes the context.\n     * @protected\n     * @param {WebGLRenderingContext} gl - WebGL context\n     */\n    protected initFromContext(gl: WebGL2RenderingContext): void\n    {\n        this.gl = gl;\n\n        this.webGLVersion = gl instanceof DOMAdapter.get().getWebGLRenderingContext() ? 1 : 2;\n\n        this.getExtensions();\n\n        this.validateContext(gl);\n\n        this._renderer.runners.contextChange.emit(gl);\n\n        const element = this._renderer.view.canvas;\n\n        (element as any).addEventListener('webglcontextlost', this.handleContextLost, false);\n        element.addEventListener('webglcontextrestored', this.handleContextRestored, false);\n    }\n\n    /**\n     * Initialize from context options\n     * @protected\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext\n     * @param preferWebGLVersion\n     * @param {object} options - context attributes\n     */\n    protected createContext(preferWebGLVersion: 1 | 2, options: WebGLContextAttributes): void\n    {\n        let gl: WebGL2RenderingContext | WebGLRenderingContext;\n\n        const canvas = this.canvas;\n\n        if (preferWebGLVersion === 2)\n        {\n            gl = canvas.getContext('webgl2', options);\n        }\n\n        if (!gl)\n        {\n            gl = canvas.getContext('webgl', options);\n\n            if (!gl)\n            {\n                // fail, not able to get a context\n                throw new Error('This browser does not support WebGL. Try using the canvas renderer');\n            }\n        }\n\n        this.gl = gl as WebGL2RenderingContext;\n\n        this.initFromContext(this.gl);\n    }\n\n    /** Auto-populate the {@link GlContextSystem.extensions extensions}. */\n    protected getExtensions(): void\n    {\n        // time to set up default extensions that Pixi uses.\n        const { gl } = this;\n\n        const common = {\n            anisotropicFiltering: gl.getExtension('EXT_texture_filter_anisotropic'),\n            floatTextureLinear: gl.getExtension('OES_texture_float_linear'),\n\n            s3tc: gl.getExtension('WEBGL_compressed_texture_s3tc'),\n            s3tc_sRGB: gl.getExtension('WEBGL_compressed_texture_s3tc_srgb'), // eslint-disable-line camelcase\n            etc: gl.getExtension('WEBGL_compressed_texture_etc'),\n            etc1: gl.getExtension('WEBGL_compressed_texture_etc1'),\n            pvrtc: gl.getExtension('WEBGL_compressed_texture_pvrtc')\n                || gl.getExtension('WEBKIT_WEBGL_compressed_texture_pvrtc'),\n            atc: gl.getExtension('WEBGL_compressed_texture_atc'),\n            astc: gl.getExtension('WEBGL_compressed_texture_astc'),\n            bptc: gl.getExtension('EXT_texture_compression_bptc'),\n            rgtc: gl.getExtension('EXT_texture_compression_rgtc'),\n            loseContext: gl.getExtension('WEBGL_lose_context'),\n        };\n\n        if (this.webGLVersion === 1)\n        {\n            this.extensions = {\n                ...common,\n\n                drawBuffers: gl.getExtension('WEBGL_draw_buffers'),\n                depthTexture: gl.getExtension('WEBGL_depth_texture'),\n                vertexArrayObject: gl.getExtension('OES_vertex_array_object')\n                    || gl.getExtension('MOZ_OES_vertex_array_object')\n                    || gl.getExtension('WEBKIT_OES_vertex_array_object'),\n                uint32ElementIndex: gl.getExtension('OES_element_index_uint'),\n                // Floats and half-floats\n                floatTexture: gl.getExtension('OES_texture_float'),\n                floatTextureLinear: gl.getExtension('OES_texture_float_linear'),\n                textureHalfFloat: gl.getExtension('OES_texture_half_float'),\n                textureHalfFloatLinear: gl.getExtension('OES_texture_half_float_linear'),\n                vertexAttribDivisorANGLE: gl.getExtension('ANGLE_instanced_arrays'),\n                srgb: gl.getExtension('EXT_sRGB'),\n            };\n        }\n        else\n        {\n            this.extensions = {\n                ...common,\n                colorBufferFloat: gl.getExtension('EXT_color_buffer_float'),\n            };\n\n            const provokeExt = gl.getExtension('WEBGL_provoking_vertex');\n\n            if (provokeExt)\n            {\n                provokeExt.provokingVertexWEBGL(provokeExt.FIRST_VERTEX_CONVENTION_WEBGL);\n            }\n        }\n    }\n\n    /**\n     * Handles a lost webgl context\n     * @param {WebGLContextEvent} event - The context lost event.\n     */\n    protected handleContextLost(event: WebGLContextEvent): void\n    {\n        event.preventDefault();\n\n        // only restore if we purposefully nuked it\n        if (this._contextLossForced)\n        {\n            this._contextLossForced = false;\n            // Restore the context after this event has exited\n            setTimeout(() =>\n            {\n                if (this.gl.isContextLost())\n                {\n                    this.extensions.loseContext?.restoreContext();\n                }\n            }, 0);\n        }\n    }\n\n    /** Handles a restored webgl context. */\n    protected handleContextRestored(): void\n    {\n        this.getExtensions(); // restore extensions state\n        this._renderer.runners.contextChange.emit(this.gl);\n    }\n\n    public destroy(): void\n    {\n        const element = this._renderer.view.canvas;\n\n        this._renderer = null;\n\n        // remove listeners\n        (element as any).removeEventListener('webglcontextlost', this.handleContextLost);\n        element.removeEventListener('webglcontextrestored', this.handleContextRestored);\n\n        this.gl.useProgram(null);\n\n        this.extensions.loseContext?.loseContext();\n    }\n\n    /**\n     * this function can be called to force a webGL context loss\n     * this will release all resources on the GPU.\n     * Useful if you need to put Pixi to sleep, and save some GPU memory\n     *\n     * As soon as render is called - all resources will be created again.\n     */\n    public forceContextLoss(): void\n    {\n        this.extensions.loseContext?.loseContext();\n        this._contextLossForced = true;\n    }\n    /**\n     * Validate context.\n     * @param {WebGLRenderingContext} gl - Render context.\n     */\n    protected validateContext(gl: WebGL2RenderingContext): void\n    {\n        const attributes = gl.getContextAttributes();\n\n        // this is going to be fairly simple for now.. but at least we have room to grow!\n        if (attributes && !attributes.stencil)\n        {\n            // #if _DEBUG\n            warn('Provided WebGL context does not have a stencil buffer, masks may not render correctly');\n            // #endif\n        }\n\n        // support\n        const supports = this.supports;\n\n        const isWebGl2 = this.webGLVersion === 2;\n        const extensions = this.extensions;\n\n        supports.uint32Indices = isWebGl2 || !!extensions.uint32ElementIndex;\n        supports.uniformBufferObject = isWebGl2;\n        supports.vertexArrayObject = isWebGl2 || !!extensions.vertexArrayObject;\n        supports.srgbTextures = isWebGl2 || !!extensions.srgb;\n        supports.nonPowOf2wrapping = isWebGl2;\n        supports.nonPowOf2mipmaps = isWebGl2;\n        supports.msaa = isWebGl2;\n\n        if (!supports.uint32Indices)\n        {\n            // #if _DEBUG\n            warn('Provided WebGL context does not support 32 index buffer, large scenes may not render correctly');\n            // #endif\n        }\n    }\n}\n"],"names":[],"mappings":"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"}